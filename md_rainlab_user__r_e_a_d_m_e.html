<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Jegyzetszerver: Front-end user plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Jegyzetszerver
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Front-end user plugin </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://github.com/rainlab/user-plugin/actions"><img src="https://img.shields.io/github/workflow/status/rainlab/user-plugin/Tests" alt="Build Status" class="inline"/></a> <a href="https://github.com/rainlab/user-plugin/blob/master/LICENCE.md"><img src="https://img.shields.io/badge/license-MIT-blue.svg" alt="MIT License" style="pointer-events: none;" class="inline"/></a></p>
<p>Front-end user management for October CMS.</p>
<h1><a class="anchor" id="autotoc_md517"></a>
Requirements</h1>
<p>This plugin requires the <a href="https://octobercms.com/docs/cms/ajax">Ajax Framework</a> to be included in your layout/page in order to handle form requests.</p>
<h1><a class="anchor" id="autotoc_md518"></a>
Managing users</h1>
<p>Users are managed on the Users tab found in the back-end. Each user provides minimal data fields - <b>Name</b>, <b>Surname</b>, <b>Email</b> and <b>Password</b>. The Name can represent either the person's first name or their full name, making the Surname field optional, depending on the complexity of your site.</p>
<p>Below the <b>Email</b> field is an checkbox to block all outgoing mail sent to the user. This is a useful feature for accounts with an email address that is bouncing mail or has reported spam. When checked, no mail will ever be sent to this address, except for the mail template used for resetting the password.</p>
<h1><a class="anchor" id="autotoc_md519"></a>
Plugin settings</h1>
<p>This plugin creates a Settings menu item, found by navigating to <b>Settings &gt; Users &gt; User settings</b>. This page allows the setting of common features, described in more detail below.</p>
<h3><a class="anchor" id="autotoc_md520"></a>
Registration</h3>
<p>Registration to the site is allowed by default. If you are running a closed site, or need to temporarily disable registration, you may disable this feature by switching <b>Allow user registration</b> to the OFF setting.</p>
<h3><a class="anchor" id="autotoc_md521"></a>
Activation</h3>
<p>Activation is a process of vetting a user who joins the site. By default, users are activated automatically when they register and an activated account is required to sign in.</p>
<p>The <b>Activation mode</b> specifies the activation workflow:</p>
<ul>
<li><b>Automatic</b>: This mode will automatically activate a user when they first register. This is the same as disabling activation entirely and is the default setting.</li>
<li><b>User</b>: The user can activate their account by responding to a confirmation message sent to their nominated email address.</li>
<li><b>Administrator</b>: The user can only be activated by an administrator via the back-end area.</li>
</ul>
<p>You can allow users to sign in without activating by switching <b>Sign in requires activation</b> to the OFF setting. This is useful for minimising friction when registering, however with this approach it is often a good idea to disable any "identity sensitive" features until the user has been activated, such as posting content. Alternatively, you could implement a grace period that deletes users (with sufficient warning!) who have not activated within a given period of time.</p>
<p>Users have the ability to resend the activation email by clicking <b>Send the verification email again</b> found in the Account component.</p>
<h3><a class="anchor" id="autotoc_md522"></a>
Sign in</h3>
<p>By default a User will sign in to the site using their email address as a unique identifier. You may use a unique login name instead by changing the <b>Login attribute</b> value to Username. This will introduce a new field called <b>Username</b> for each user, allowing them to specify their own short name or alias for identification. Both the Email address and Username must be unique to the user.</p>
<p>If a user experiences too many failed sign in attempts, their account will be temporarily suspended for a period of time. This feature is enabled by default and will suspend an account for 15 minutes after 5 failed sign in attempts, for a given IP address. You may disable this feature by switching <b>Throttle attempts</b> to the OFF setting.</p>
<p>As a security precaution, you may restrict users from having sessions across multiple devices at the same time. Enable the <b>Prevent concurrent sessions</b> setting to use this feature. When a user signs in to their account, it will automatically sign out the user for all other sessions.</p>
<h3><a class="anchor" id="autotoc_md523"></a>
Notifications</h3>
<p>When a user is first activated &ndash; either by registration, email confirmation or administrator approval &ndash; they are sent a welcome email. To disable the welcome email, select "Do not send a notification" from the <b>Welcome mail template</b> dropdown. The default message template used is <code>rainlab.user::mail.welcome</code> and you can customize this by selecting <b>Mail &gt; Mail Templates</b> from the settings menu.</p>
<h1><a class="anchor" id="autotoc_md524"></a>
Extended features</h1>
<p>For extra functionality, consider also installing the <a href="http://octobercms.com/plugin/rainlab-userplus">User Plus+ plugin</a> (<code>RainLab.UserPlus</code>).</p>
<h1><a class="anchor" id="autotoc_md525"></a>
Session component</h1>
<p>The session component should be added to a layout that has registered users. It has no default markup.</p>
<h2><a class="anchor" id="autotoc_md526"></a>
User variable</h2>
<p>You can check the logged in user by accessing the **{{ user }}** Twig variable: </p><pre class="fragment">{% if user %}
    &lt;p&gt;Hello {{ user.name }}&lt;/p&gt;
{% else %}
    &lt;p&gt;Nobody is logged in&lt;/p&gt;
{% endif %}
</pre> <h2><a class="anchor" id="autotoc_md527"></a>
Signing out</h2>
<p>The Session component allows a user to sign out of their session. </p><pre class="fragment">&lt;a data-request="onLogout" data-request-data="redirect: '/good-bye'"&gt;Sign out&lt;/a&gt;
</pre> <h2><a class="anchor" id="autotoc_md528"></a>
Page restriction</h2>
<p>The Session component allows the restriction of a page or layout by allowing only signed in users, only guests or no restriction. This example shows how to restrict a page to users only: </p><pre class="fragment">title = "Restricted page"
url = "/users-only"

[session]
security = "user"
redirect = "home"
</pre><p> The <code>security</code> property can be user, guest or all. The <code>redirect</code> property refers to a page name to redirect to when access is restricted.</p>
<h2><a class="anchor" id="autotoc_md529"></a>
Route restriction</h2>
<p>Access to routes can be restricted by applying the <code>AuthMiddleware</code>. </p><pre class="fragment">Route::group(['middleware' =&gt; 'RainLab\User\Classes\AuthMiddleware'], function () {
    // All routes here will require authentication
});
</pre> <h1><a class="anchor" id="autotoc_md530"></a>
Account component</h1>
<p>The account component provides a user sign in form, registration form, activation form and update form. To display the form: </p><pre class="fragment">title = "Account"
url = "/account/:code?"

[account]
redirect = "home"
paramCode = "code"
==
{% component 'account' %}
</pre><p> If the user is logged out, this will display a sign in and registration form. Otherwise, it will display an update form. The <code>redirect</code> property is the page name to redirect to after the submit process is complete. The <code>paramCode</code> is the URL routing code used for activating the user, only used if the feature is enabled.</p>
<h1><a class="anchor" id="autotoc_md531"></a>
Reset Password component</h1>
<p>The reset password component allows a user to reset their password if they have forgotten it. </p><pre class="fragment">title = "Forgotten your password?"
url = "/forgot-password/:code?"

[resetPassword]
paramCode = "code"
==
{% component 'resetPassword' %}
</pre><p> This will display the initial restoration request form and also the password reset form used after the verification email has been received by the user. The <code>paramCode</code> is the URL routing code used for resetting the password.</p>
<h1><a class="anchor" id="autotoc_md532"></a>
Using a login name</h1>
<p>By default the User plugin will use the email address as the login name. To switch to using a user defined login name, navigate to the backend under System &gt; Users &gt; User Settings and change the Login attribute under the Sign in tab to be <b>Username</b>. Then simply ask for a username upon registration by adding the username field: </p><pre class="fragment">&lt;form data-request="onRegister"&gt;
    &lt;label&gt;Full Name&lt;/label&gt;
    &lt;input name="name" type="text" placeholder="Enter your full name"&gt;

    &lt;label&gt;Email&lt;/label&gt;
    &lt;input name="email" type="email" placeholder="Enter your email"&gt;

    &lt;label&gt;Username&lt;/label&gt;
    &lt;input name="username" placeholder="Pick a login name"&gt;

    &lt;label&gt;Password&lt;/label&gt;
    &lt;input name="password" type="password" placeholder="Choose a password"&gt;

    &lt;button type="submit"&gt;Register&lt;/button&gt;
&lt;/form&gt;
</pre><p> We can add any other additional fields here too, such as <code>phone</code>, <code>company</code>, etc.</p>
<h1><a class="anchor" id="autotoc_md533"></a>
Password length requirements</h1>
<p>By default, the User plugin requires a minimum password length of 8 characters for all users when registering or changing their password. You can change this length requirement by going to backend and navigating to System &gt; Users &gt; User Settings. Inside the Registration tab, a <b>Minimum password length</b> field is provided, allowing you to increase or decrease this limit to your preferred length.</p>
<h1><a class="anchor" id="autotoc_md534"></a>
Error handling</h1>
<h2><a class="anchor" id="autotoc_md535"></a>
Flash messages</h2>
<p>This plugin makes use of October's <a href="http://octobercms.com/docs/markup/tag-flash"><code>Flash API</code></a>. In order to display the error messages, you need to place the following snippet in your layout or page. </p><pre class="fragment">{% flash %}
    &lt;div class="alert alert-{{ type == 'error' ? 'danger' : type }}"&gt;{{ message }}&lt;/div&gt;
{% endflash %}
</pre> <h2><a class="anchor" id="autotoc_md536"></a>
AJAX errors</h2>
<p>The User plugin displays AJAX error messages in a simple <code>alert()</code>-box by default. However, this might scare non-technical users. You can change the default behavior of an AJAX error from displaying an <code>alert()</code> message, like this: </p><pre class="fragment">&lt;script&gt;
    $(window).on('ajaxErrorMessage', function (event, message){

        // This can be any custom JavaScript you want
        alert('Something bad happened, mate, here it is: ' + message);

        // This will stop the default alert() message
        event.preventDefault();

    })
&lt;/script&gt;
</pre> <h2><a class="anchor" id="autotoc_md537"></a>
Checking if a login name is already taken</h2>
<p>Here is a simple example of how you can quickly check if an email address / username is available in your registration forms. First, inside the page code, define the following AJAX handler to check the login name, here we are using the email address: </p><pre class="fragment">public function onCheckEmail()
{
    return ['isTaken' =&gt; Auth::findUserByLogin(post('email')) ? 1 : 0];
}
</pre><p> For the email input we use the <code>data-request</code> and <code>data-track-input</code> attributes to call the <code>onCheckEmail</code> handler any time the field is updated. The <code>data-request-success</code> attribute will call some jQuery code to toggle the alert box. </p><pre class="fragment">&lt;div class="form-group"&gt;
    &lt;label&gt;Email address&lt;/label&gt;
    &lt;input
        name="email"
        type="email"
        class="form-control"
        data-request="onCheckEmail"
        data-request-success="$('#loginTaken').toggle(!!data.isTaken)"
        data-track-input /&gt;
&lt;/div&gt;

&lt;div id="loginTaken" class="alert alert-danger" style="display: none"&gt;
    Sorry, that login name is already taken.
&lt;/div&gt;
</pre> <h1><a class="anchor" id="autotoc_md538"></a>
Overriding functionality</h1>
<p>Here is how you would override the <code>onSignin()</code> handler to log any error messages. Inside the page code, define this method: </p><pre class="fragment">function onSignin()
{
    try {
        return $this-&gt;account-&gt;onSignin();
    }
    catch (Exception $ex) {
        Log::error($ex);
    }
}
</pre><p> Here the local handler method will take priority over the <b>account</b> component's event handler. Then we simply inherit the logic by calling the parent handler manually, via the component object (<code>$this-&gt;account</code>).</p>
<h1><a class="anchor" id="autotoc_md539"></a>
Auth facade</h1>
<p>There is an <code>Auth</code> facade you may use for common tasks, it primarily inherits the <code>October\Rain\Auth\Manager</code> class for functionality.</p>
<p>You may use <code>Auth::register</code> to register an account: </p><pre class="fragment">$user = Auth::register([
    'name' =&gt; 'Some User',
    'email' =&gt; 'some@website.tld',
    'password' =&gt; 'changeme',
    'password_confirmation' =&gt; 'changeme',
]);
</pre><p> The second argument can specify if the account should be automatically activated: </p><pre class="fragment">// Auto activate this user
$user = Auth::register([...], true);
</pre><p> The <code>Auth::check</code> method is a quick way to check if the user is signed in. </p><pre class="fragment">// Returns true if signed in.
$loggedIn = Auth::check();
</pre><p> To return the user model that is signed in, use <code>Auth::getUser</code> instead. </p><pre class="fragment">// Returns the signed in user
$user = Auth::getUser();
</pre><p> You may authenticate a user by providing their login and password with <code>Auth::authenticate</code>. </p><pre class="fragment">// Authenticate user by credentials
$user = Auth::authenticate([
    'login' =&gt; post('login'),
    'password' =&gt; post('password')
]);
</pre><p> The second argument is used to store a non-expire cookie for the user. </p><pre class="fragment">$user = Auth::authenticate([...], true);
</pre><p> You can also authenticate as a user simply by passing the user model along with <code>Auth::login</code>. </p><pre class="fragment">// Sign in as a specific user
Auth::login($user);
</pre><p> The second argument is the same. </p><pre class="fragment">// Sign in and remember the user
Auth::login($user, true);
</pre><p> You may look up a user by their login name using the <code>Auth::findUserByLogin</code> method. </p><pre class="fragment">$user = Auth::findUserByLogin('some@email.tld');
</pre> <h1><a class="anchor" id="autotoc_md540"></a>
Guest users</h1>
<p>Creating a guest user allows the registration process to be deferred. For example, making a purchase without needing to register first. Guest users are not able to sign in and will be added to the user group with the code <code>guest</code>.</p>
<p>Use the <code>Auth::registerGuest</code> method to create a guest user, it will return a user object and can be called multiple times. The unique identifier is the email address, which is a required field. </p><pre class="fragment">$user = Auth::registerGuest(['email' =&gt; 'person@acme.tld']);
</pre><p> When a user registers with the same email address using the <code>Auth::register</code> method, they will inherit the existing guest user account. </p><pre class="fragment">// This will not throw an "Email already taken" error
$user = Auth::register([
    'email' =&gt; 'person@acme.tld',
    'password' =&gt; 'changeme',
    'password_confirmation' =&gt; 'changeme',
]);
</pre> <blockquote class="doxtable">
<p><b>Important</b>: If you are using guest accounts, it is important to disable sensitive functionality for user accounts that are not verified, since it may be possible for anyone to inherit a guest account. </p>
</blockquote>
<p>You may also convert a guest to a registered user with the <code>convertToRegistered</code> method. This will generate a random password and sends an invitation using the <code>rainlab.user::mail.invite</code> template. </p><pre class="fragment">$user-&gt;convertToRegistered();
</pre><p> To disable the notification and password reset, pass the first argument as false. </p><pre class="fragment">$user-&gt;convertToRegistered(false);
</pre> <h1><a class="anchor" id="autotoc_md541"></a>
Events</h1>
<p>This plugin will fire some global events that can be useful for interacting with other plugins.</p>
<ul>
<li><b>rainlab.user.beforeRegister</b>: Before the user's registration is processed. Passed the <code>$data</code> variable by reference to enable direct modifications to the <code>$data</code> provided to the <code>Auth::register()</code> method.</li>
<li><b>rainlab.user.register</b>: The user has successfully registered. Passed the <code>$user</code> object and the submitted <code>$data</code> variable.</li>
<li><b>rainlab.user.beforeAuthenticate</b>: Before the user is attempting to authenticate using the Account component.</li>
<li><b>rainlab.user.login</b>: The user has successfully signed in.</li>
<li><b>rainlab.user.logout</b>: The user has successfully signed out.</li>
<li><b>rainlab.user.deactivate</b>: The user has opted-out of the site by deactivating their account. This should be used to disable any content the user may want removed.</li>
<li><b>rainlab.user.reactivate</b>: The user has reactivated their own account by signing back in. This should revive the users content on the site.</li>
<li><b>rainlab.user.getNotificationVars</b>: Fires when sending a user notification to enable passing more variables to the email templates. Passes the <code>$user</code> model the template will be for.</li>
<li><b>rainlab.user.view.extendListToolbar</b>: Fires when the user listing page's toolbar is rendered.</li>
<li><b>rainlab.user.view.extendPreviewToolbar</b>: Fires when the user preview page's toolbar is rendered.</li>
</ul>
<p>Here is an example of hooking an event: </p><pre class="fragment">Event::listen('rainlab.user.deactivate', function($user) {
    // Hide all posts by the user
});
</pre><p> A common requirement is to adapt another to a legacy authentication system. In the example below, the <code>WordPressLogin::check</code> method would check the user password using an alternative hashing method, and if successful, update to the new one used by October. </p><pre class="fragment">Event::listen('rainlab.user.beforeAuthenticate', function($component, $credentials) {
    $login = array_get($credentials, 'login');
    $password = array_get($credentials, 'password');

    /*
     * No such user exists
     */
    if (!$user = Auth::findUserByLogin($login)) {
        return;
    }

    /*
     * The user is logging in with their old WordPress account
     * for the first time. Rehash their password using the new
     * October system.
     */
    if (WordPressLogin::check($user-&gt;password, $password)) {
        $user-&gt;password = $user-&gt;password_confirmation = $password;
        $user-&gt;forceSave();
    }
});
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
